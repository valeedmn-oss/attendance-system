<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .status-present { background: linear-gradient(135deg, #10b981, #059669); }
        .status-justified { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .status-late { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .status-absent { background: linear-gradient(135deg, #ef4444, #dc2626); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                    <span class="text-4xl ml-3">ğŸ«</span>
                    Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨
                </h1>
                <div class="text-sm text-gray-600">
                    <span id="currentDate"></span>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Navigation Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-8 overflow-hidden">
            <div class="flex border-b">
                <button id="attendanceTab" class="flex-1 py-4 px-6 text-center font-semibold text-blue-600 bg-blue-50 border-b-2 border-blue-500 transition-all duration-200">
                    ğŸ“‹ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨
                </button>
                <button id="membersTab" class="flex-1 py-4 px-6 text-center font-semibold text-gray-600 hover:text-blue-600 hover:bg-gray-50 transition-all duration-200">
                    ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§
                </button>
                <button id="reportsTab" class="flex-1 py-4 px-6 text-center font-semibold text-gray-600 hover:text-blue-600 hover:bg-gray-50 transition-all duration-200">
                    ğŸ“Š Ú¯Ø²Ø§Ø±Ø´Ø§Øª
                </button>
            </div>
        </div>

        <!-- Attendance Section -->
        <div id="attendanceSection" class="fade-in">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Member List for Attendance -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">âœ…</span>
                        Ø«Ø¨Øª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨
                    </h2>
                    <div id="attendanceList" class="space-y-3">
                        <!-- Members will be populated here -->
                    </div>
                </div>

                <!-- Today's Summary -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">ğŸ“ˆ</span>
                        Ø®Ù„Ø§ØµÙ‡ Ø§Ù…Ø±ÙˆØ²
                    </h2>
                    <div class="space-y-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <span class="text-green-800 font-semibold">Ø­Ø§Ø¶Ø±</span>
                                <span id="presentCount" class="text-2xl font-bold text-green-600">0</span>
                            </div>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <span class="text-blue-800 font-semibold">ØºÛŒØ¨Øª Ù…ÙˆØ¬Ù‡</span>
                                <span id="justifiedCount" class="text-2xl font-bold text-blue-600">0</span>
                            </div>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <span class="text-yellow-800 font-semibold">ØªØ§Ø®ÛŒØ±</span>
                                <span id="lateCount" class="text-2xl font-bold text-yellow-600">0</span>
                            </div>
                        </div>
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <span class="text-red-800 font-semibold">ØºØ§ÛŒØ¨</span>
                                <span id="absentCount" class="text-2xl font-bold text-red-600">0</span>
                            </div>
                        </div>
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-800 font-semibold">Ú©Ù„ Ø§Ø¹Ø¶Ø§</span>
                                <span id="totalCount" class="text-2xl font-bold text-gray-600">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Members Management Section -->
        <div id="membersSection" class="hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Add Member Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">â•</span>
                        Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯
                    </h2>
                    <form id="addMemberForm" class="space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†Ø§Ù…</label>
                                <input type="text" id="memberFirstName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Ù†Ø§Ù…" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                                <input type="text" id="memberLastName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" required>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ú©Ø¯ Ù…Ù„ÛŒ</label>
                                <input type="text" id="memberNationalId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Ú©Ø¯ Ù…Ù„ÛŒ" maxlength="10">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                                <input type="tel" id="memberPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="09123456789">
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ ÙˆØ§Ù„Ø¯ÛŒÙ†</label>
                                <input type="tel" id="memberParentPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ù„Ø¯ÛŒÙ†">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ø³Ø§Ù„ ÙˆØ±ÙˆØ¯ÛŒ</label>
                                <input type="number" id="memberEntryYear" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="1403" min="1380" max="1450">
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ù‡Ø±ÛŒÙ‡</label>
                                <select id="memberTuitionStatus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                                    <option value="paid">Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</option>
                                    <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª</option>
                                    <option value="partial">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¬Ø²Ø¦ÛŒ</option>
                                    <option value="exempt">Ù…Ø¹Ø§Ù</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ÙˆØ¶Ø¹ÛŒØª ØªØ¹Ù‡Ø¯Ù†Ø§Ù…Ù‡</label>
                                <select id="memberCommitmentStatus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                                    <option value="signed">Ø§Ù…Ø¶Ø§ Ø´Ø¯Ù‡</option>
                                    <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù…Ø¶Ø§</option>
                                    <option value="not_required">Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                            <textarea id="memberNotes" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ..."></textarea>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105">
                            â• Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ø¶Ùˆ
                        </button>
                    </form>
                </div>

                <!-- Members List -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-2">ğŸ‘¥</span>
                        Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§
                    </h2>
                    <div id="membersList" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Members will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reportsSection" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl ml-2">ğŸ“Š</span>
                    Ú¯Ø²Ø§Ø±Ø´ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨
                </h2>
                <div class="mb-6 grid md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ø³Ø§Ù„</label>
                        <select id="reportYear" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <!-- Years will be populated -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ù…Ø§Ù‡</label>
                        <select id="reportMonth" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="1">ÙØ±ÙˆØ±Ø¯ÛŒÙ†</option>
                            <option value="2">Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª</option>
                            <option value="3">Ø®Ø±Ø¯Ø§Ø¯</option>
                            <option value="4">ØªÛŒØ±</option>
                            <option value="5">Ù…Ø±Ø¯Ø§Ø¯</option>
                            <option value="6">Ø´Ù‡Ø±ÛŒÙˆØ±</option>
                            <option value="7">Ù…Ù‡Ø±</option>
                            <option value="8">Ø¢Ø¨Ø§Ù†</option>
                            <option value="9">Ø¢Ø°Ø±</option>
                            <option value="10">Ø¯ÛŒ</option>
                            <option value="11">Ø¨Ù‡Ù…Ù†</option>
                            <option value="12">Ø§Ø³ÙÙ†Ø¯</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ø±ÙˆØ²</label>
                        <select id="reportDay" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <!-- Days will be populated -->
                        </select>
                    </div>
                </div>
                <button id="generateReport" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition-all duration-200">
                    ğŸ“‹ ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´
                </button>
                <div id="reportContent" class="mt-6 space-y-4">
                    <!-- Report content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Member Details Modal -->
    <div id="memberModal" class="modal hidden">
        <div class="modal-content w-full max-w-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Ø¬Ø²Ø¦ÛŒØ§Øª Ø¹Ø¶Ùˆ</h3>
                <button id="closeMemberModal" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            <div id="memberDetails">
                <!-- Member details will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Persian date utilities
        const persianMonths = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'];
        const persianDays = ['ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡'];

        function toPersianDate(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            return date.toLocaleDateString('fa-IR', options);
        }

        function getCurrentPersianDate() {
            const now = new Date();
            const persianDate = new Intl.DateTimeFormat('fa-IR-u-nu-latn').format(now).split('/');
            return {
                year: parseInt(persianDate[0]),
                month: parseInt(persianDate[1]),
                day: parseInt(persianDate[2])
            };
        }

        // Data storage
        let members = JSON.parse(localStorage.getItem('members')) || [];
        let attendance = JSON.parse(localStorage.getItem('attendance')) || {};

        // DOM elements
        const attendanceTab = document.getElementById('attendanceTab');
        const membersTab = document.getElementById('membersTab');
        const reportsTab = document.getElementById('reportsTab');
        const attendanceSection = document.getElementById('attendanceSection');
        const membersSection = document.getElementById('membersSection');
        const reportsSection = document.getElementById('reportsSection');
        const addMemberForm = document.getElementById('addMemberForm');
        const currentDateSpan = document.getElementById('currentDate');
        const memberModal = document.getElementById('memberModal');
        const closeMemberModal = document.getElementById('closeMemberModal');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            renderAttendanceList();
            renderMembersList();
            updateSummary();
            initializeReportSelectors();
        });

        // Tab switching
        attendanceTab.addEventListener('click', () => switchTab('attendance'));
        membersTab.addEventListener('click', () => switchTab('members'));
        reportsTab.addEventListener('click', () => switchTab('reports'));

        function switchTab(tab) {
            // Reset tab styles
            [attendanceTab, membersTab, reportsTab].forEach(t => {
                t.className = 'flex-1 py-4 px-6 text-center font-semibold text-gray-600 hover:text-blue-600 hover:bg-gray-50 transition-all duration-200';
            });

            // Hide all sections
            [attendanceSection, membersSection, reportsSection].forEach(s => {
                s.classList.add('hidden');
            });

            // Show selected tab and section
            if (tab === 'attendance') {
                attendanceTab.className = 'flex-1 py-4 px-6 text-center font-semibold text-blue-600 bg-blue-50 border-b-2 border-blue-500 transition-all duration-200';
                attendanceSection.classList.remove('hidden');
                attendanceSection.classList.add('fade-in');
            } else if (tab === 'members') {
                membersTab.className = 'flex-1 py-4 px-6 text-center font-semibold text-blue-600 bg-blue-50 border-b-2 border-blue-500 transition-all duration-200';
                membersSection.classList.remove('hidden');
                membersSection.classList.add('fade-in');
            } else if (tab === 'reports') {
                reportsTab.className = 'flex-1 py-4 px-6 text-center font-semibold text-blue-600 bg-blue-50 border-b-2 border-blue-500 transition-all duration-200';
                reportsSection.classList.remove('hidden');
                reportsSection.classList.add('fade-in');
            }
        }

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            currentDateSpan.textContent = toPersianDate(now);
        }

        // Initialize report selectors
        function initializeReportSelectors() {
            const currentPersian = getCurrentPersianDate();
            const yearSelect = document.getElementById('reportYear');
            const monthSelect = document.getElementById('reportMonth');
            const daySelect = document.getElementById('reportDay');

            // Populate years
            for (let year = currentPersian.year - 5; year <= currentPersian.year + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentPersian.year) option.selected = true;
                yearSelect.appendChild(option);
            }

            // Set current month
            monthSelect.value = currentPersian.month;

            // Populate days
            function updateDays() {
                daySelect.innerHTML = '';
                const daysInMonth = 31; // Simplified - in real app would calculate based on Persian calendar
                for (let day = 1; day <= daysInMonth; day++) {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = day;
                    if (day === currentPersian.day) option.selected = true;
                    daySelect.appendChild(option);
                }
            }

            updateDays();
            monthSelect.addEventListener('change', updateDays);
            yearSelect.addEventListener('change', updateDays);
        }

        // Add member
        addMemberForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const firstName = document.getElementById('memberFirstName').value.trim();
            const lastName = document.getElementById('memberLastName').value.trim();
            const nationalId = document.getElementById('memberNationalId').value.trim();
            const phone = document.getElementById('memberPhone').value.trim();
            const parentPhone = document.getElementById('memberParentPhone').value.trim();
            const entryYear = document.getElementById('memberEntryYear').value;
            const tuitionStatus = document.getElementById('memberTuitionStatus').value;
            const commitmentStatus = document.getElementById('memberCommitmentStatus').value;
            const notes = document.getElementById('memberNotes').value.trim();

            if (firstName && lastName) {
                const newMember = {
                    id: Date.now(),
                    firstName: firstName,
                    lastName: lastName,
                    fullName: `${firstName} ${lastName}`,
                    nationalId: nationalId,
                    phone: phone,
                    parentPhone: parentPhone,
                    entryYear: entryYear,
                    tuitionStatus: tuitionStatus,
                    commitmentStatus: commitmentStatus,
                    notes: notes,
                    joinDate: toPersianDate(new Date())
                };

                members.push(newMember);
                localStorage.setItem('members', JSON.stringify(members));
                
                // Reset form
                addMemberForm.reset();
                
                // Update displays
                renderMembersList();
                renderAttendanceList();
                updateSummary();

                showNotification('Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! âœ…', 'success');
            }
        });

        // Render members list
        function renderMembersList() {
            const membersList = document.getElementById('membersList');
            
            if (members.length === 0) {
                membersList.innerHTML = '<p class="text-gray-500 text-center py-8">Ù‡Ù†ÙˆØ² Ø¹Ø¶ÙˆÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>';
                return;
            }

            membersList.innerHTML = members.map(member => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all duration-200 cursor-pointer" onclick="showMemberDetails(${member.id})">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800 text-lg">${member.fullName}</h3>
                            <p class="text-sm text-gray-600">Ú©Ø¯ Ù…Ù„ÛŒ: ${member.nationalId || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                            <p class="text-sm text-gray-600">ØªÙ…Ø§Ø³: ${member.phone || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                            <div class="flex items-center mt-2 space-x-2 space-x-reverse">
                                <span class="px-2 py-1 text-xs rounded-full ${getTuitionStatusClass(member.tuitionStatus)}">
                                    ${getTuitionStatusText(member.tuitionStatus)}
                                </span>
                                <span class="px-2 py-1 text-xs rounded-full ${getCommitmentStatusClass(member.commitmentStatus)}">
                                    ${getCommitmentStatusText(member.commitmentStatus)}
                                </span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <button onclick="event.stopPropagation(); showMemberDetails(${member.id})" class="text-blue-500 hover:text-blue-700 transition-colors duration-200">
                                ğŸ‘ï¸
                            </button>
                            <button onclick="event.stopPropagation(); removeMember(${member.id})" class="text-red-500 hover:text-red-700 transition-colors duration-200">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Status helper functions
        function getTuitionStatusClass(status) {
            const classes = {
                'paid': 'bg-green-100 text-green-800',
                'pending': 'bg-yellow-100 text-yellow-800',
                'partial': 'bg-orange-100 text-orange-800',
                'exempt': 'bg-blue-100 text-blue-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        function getTuitionStatusText(status) {
            const texts = {
                'paid': 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡',
                'pending': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±',
                'partial': 'Ø¬Ø²Ø¦ÛŒ',
                'exempt': 'Ù…Ø¹Ø§Ù'
            };
            return texts[status] || 'Ù†Ø§Ù…Ø´Ø®Øµ';
        }

        function getCommitmentStatusClass(status) {
            const classes = {
                'signed': 'bg-green-100 text-green-800',
                'pending': 'bg-yellow-100 text-yellow-800',
                'not_required': 'bg-gray-100 text-gray-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        function getCommitmentStatusText(status) {
            const texts = {
                'signed': 'Ø§Ù…Ø¶Ø§ Ø´Ø¯Ù‡',
                'pending': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±',
                'not_required': 'Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª'
            };
            return texts[status] || 'Ù†Ø§Ù…Ø´Ø®Øµ';
        }

        // Show member details modal
        function showMemberDetails(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) return;

            // Calculate attendance statistics
            const stats = calculateMemberStats(memberId);

            const memberDetails = document.getElementById('memberDetails');
            memberDetails.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b pb-2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h4>
                        <div class="space-y-2">
                            <p><span class="font-semibold">Ù†Ø§Ù… Ú©Ø§Ù…Ù„:</span> ${member.fullName}</p>
                            <p><span class="font-semibold">Ú©Ø¯ Ù…Ù„ÛŒ:</span> ${member.nationalId || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                            <p><span class="font-semibold">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</span> ${member.phone || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                            <p><span class="font-semibold">ØªÙ…Ø§Ø³ ÙˆØ§Ù„Ø¯ÛŒÙ†:</span> ${member.parentPhone || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                            <p><span class="font-semibold">Ø³Ø§Ù„ ÙˆØ±ÙˆØ¯ÛŒ:</span> ${member.entryYear || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                            <p><span class="font-semibold">ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª:</span> ${member.joinDate}</p>
                        </div>
                        
                        <h4 class="text-lg font-semibold text-gray-800 border-b pb-2 mt-6">ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ø§Ø±ÛŒ</h4>
                        <div class="space-y-2">
                            <p><span class="font-semibold">Ø´Ù‡Ø±ÛŒÙ‡:</span> 
                                <span class="px-2 py-1 text-xs rounded-full ${getTuitionStatusClass(member.tuitionStatus)}">
                                    ${getTuitionStatusText(member.tuitionStatus)}
                                </span>
                            </p>
                            <p><span class="font-semibold">ØªØ¹Ù‡Ø¯Ù†Ø§Ù…Ù‡:</span> 
                                <span class="px-2 py-1 text-xs rounded-full ${getCommitmentStatusClass(member.commitmentStatus)}">
                                    ${getCommitmentStatusText(member.commitmentStatus)}
                                </span>
                            </p>
                        </div>
                        
                        ${member.notes ? `
                            <h4 class="text-lg font-semibold text-gray-800 border-b pb-2 mt-6">ØªÙˆØ¶ÛŒØ­Ø§Øª</h4>
                            <p class="text-gray-700 bg-gray-50 p-3 rounded-lg">${member.notes}</p>
                        ` : ''}
                    </div>
                    
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b pb-2">Ø¢Ù…Ø§Ø± Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-green-600">${stats.present}</div>
                                <div class="text-sm text-green-800">Ø­Ø§Ø¶Ø±</div>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-blue-600">${stats.justified}</div>
                                <div class="text-sm text-blue-800">Ù…ÙˆØ¬Ù‡</div>
                            </div>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-yellow-600">${stats.late}</div>
                                <div class="text-sm text-yellow-800">ØªØ§Ø®ÛŒØ±</div>
                            </div>
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-red-600">${stats.absent}</div>
                                <div class="text-sm text-red-800">ØºØ§ÛŒØ¨</div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <h5 class="font-semibold text-gray-800 mb-2">Ø®Ù„Ø§ØµÙ‡</h5>
                            <p class="text-sm text-gray-600">Ú©Ù„ Ø¬Ù„Ø³Ø§Øª: ${stats.total}</p>
                            <p class="text-sm text-gray-600">Ø¯Ø±ØµØ¯ Ø­Ø¶ÙˆØ±: ${stats.total > 0 ? Math.round((stats.present / stats.total) * 100) : 0}%</p>
                            <p class="text-sm text-gray-600">Ú©Ù„ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§: ${stats.absent + stats.late}</p>
                        </div>
                    </div>
                </div>
            `;

            memberModal.classList.remove('hidden');
        }

        // Calculate member statistics
        function calculateMemberStats(memberId) {
            let present = 0, justified = 0, late = 0, absent = 0;
            
            Object.values(attendance).forEach(dayAttendance => {
                const status = dayAttendance[memberId];
                if (status === 'present') present++;
                else if (status === 'justified') justified++;
                else if (status === 'late') late++;
                else if (status === 'absent') absent++;
            });
            
            return {
                present,
                justified,
                late,
                absent,
                total: present + justified + late + absent
            };
        }

        // Close modal
        closeMemberModal.addEventListener('click', () => {
            memberModal.classList.add('hidden');
        });

        memberModal.addEventListener('click', (e) => {
            if (e.target === memberModal) {
                memberModal.classList.add('hidden');
            }
        });

        // Remove member
        function removeMember(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¹Ø¶Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                members = members.filter(member => member.id !== id);
                localStorage.setItem('members', JSON.stringify(members));
                renderMembersList();
                renderAttendanceList();
                updateSummary();
                showNotification('Ø¹Ø¶Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯', 'success');
            }
        }

        // Render attendance list
        function renderAttendanceList() {
            const attendanceList = document.getElementById('attendanceList');
            const today = new Date().toDateString();
            
            if (members.length === 0) {
                attendanceList.innerHTML = '<p class="text-gray-500 text-center py-8">Ø§Ø¨ØªØ¯Ø§ Ø§Ø¹Ø¶Ø§ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯</p>';
                return;
            }

            attendanceList.innerHTML = members.map(member => {
                const status = attendance[today] && attendance[today][member.id];
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all duration-200">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <h3 class="font-semibold text-gray-800">${member.fullName}</h3>
                                <p class="text-sm text-gray-600">Ú©Ø¯ Ù…Ù„ÛŒ: ${member.nationalId || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                            </div>
                            <div class="text-2xl">
                                ${getStatusIcon(status)}
                            </div>
                        </div>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="markAttendance(${member.id}, 'present')" 
                                    class="px-3 py-2 rounded-lg font-semibold text-white text-sm transition-all duration-200 ${status === 'present' ? 'status-present' : 'bg-gray-300 hover:bg-green-400'}">
                                âœ… Ø­Ø§Ø¶Ø±
                            </button>
                            <button onclick="markAttendance(${member.id}, 'justified')" 
                                    class="px-3 py-2 rounded-lg font-semibold text-white text-sm transition-all duration-200 ${status === 'justified' ? 'status-justified' : 'bg-gray-300 hover:bg-blue-400'}">
                                ğŸ“‹ Ù…ÙˆØ¬Ù‡
                            </button>
                            <button onclick="markAttendance(${member.id}, 'late')" 
                                    class="px-3 py-2 rounded-lg font-semibold text-white text-sm transition-all duration-200 ${status === 'late' ? 'status-late' : 'bg-gray-300 hover:bg-yellow-400'}">
                                â° ØªØ§Ø®ÛŒØ±
                            </button>
                            <button onclick="markAttendance(${member.id}, 'absent')" 
                                    class="px-3 py-2 rounded-lg font-semibold text-white text-sm transition-all duration-200 ${status === 'absent' ? 'status-absent' : 'bg-gray-300 hover:bg-red-400'}">
                                âŒ ØºØ§ÛŒØ¨
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getStatusIcon(status) {
            const icons = {
                'present': 'âœ…',
                'justified': 'ğŸ“‹',
                'late': 'â°',
                'absent': 'âŒ'
            };
            return icons[status] || 'â³';
        }

        // Mark attendance
        function markAttendance(memberId, status) {
            const today = new Date().toDateString();
            
            if (!attendance[today]) {
                attendance[today] = {};
            }
            
            attendance[today][memberId] = status;
            localStorage.setItem('attendance', JSON.stringify(attendance));
            
            renderAttendanceList();
            updateSummary();
            
            const member = members.find(m => m.id === memberId);
            const statusText = {
                'present': 'Ø­Ø§Ø¶Ø±',
                'justified': 'ØºÛŒØ¨Øª Ù…ÙˆØ¬Ù‡',
                'late': 'ØªØ§Ø®ÛŒØ±',
                'absent': 'ØºØ§ÛŒØ¨'
            };
            showNotification(`${member.fullName} Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ${statusText[status]} Ø«Ø¨Øª Ø´Ø¯`, 'success');
        }

        // Update summary
        function updateSummary() {
            const today = new Date().toDateString();
            const todayAttendance = attendance[today] || {};
            
            let presentCount = 0, justifiedCount = 0, lateCount = 0, absentCount = 0;
            
            members.forEach(member => {
                const status = todayAttendance[member.id];
                if (status === 'present') presentCount++;
                else if (status === 'justified') justifiedCount++;
                else if (status === 'late') lateCount++;
                else if (status === 'absent') absentCount++;
            });
            
            document.getElementById('presentCount').textContent = presentCount;
            document.getElementById('justifiedCount').textContent = justifiedCount;
            document.getElementById('lateCount').textContent = lateCount;
            document.getElementById('absentCount').textContent = absentCount;
            document.getElementById('totalCount').textContent = members.length;
        }

        // Generate report
        document.getElementById('generateReport').addEventListener('click', function() {
            const year = document.getElementById('reportYear').value;
            const month = document.getElementById('reportMonth').value;
            const day = document.getElementById('reportDay').value;
            
            if (!year || !month || !day) {
                showNotification('Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ú©Ø§Ù…Ù„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            // Convert Persian date to Gregorian for lookup
            // This is simplified - in real app would use proper date conversion
            const selectedDate = new Date().toDateString(); // Simplified for demo
            const dayAttendance = attendance[selectedDate] || {};
            
            const reportContent = document.getElementById('reportContent');
            
            if (Object.keys(dayAttendance).length === 0) {
                reportContent.innerHTML = '<p class="text-gray-500 text-center py-8">Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ§Ø±ÛŒØ® Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>';
                return;
            }
            
            const presentMembers = [];
            const justifiedMembers = [];
            const lateMembers = [];
            const absentMembers = [];
            
            members.forEach(member => {
                const status = dayAttendance[member.id];
                if (status === 'present') presentMembers.push(member);
                else if (status === 'justified') justifiedMembers.push(member);
                else if (status === 'late') lateMembers.push(member);
                else if (status === 'absent') absentMembers.push(member);
            });
            
            reportContent.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="font-bold text-green-800 mb-3">âœ… Ø­Ø§Ø¶Ø±ÛŒÙ† (${presentMembers.length})</h3>
                        ${presentMembers.map(member => `
                            <div class="text-green-700 py-1 border-b border-green-200 last:border-b-0">
                                ${member.fullName}
                            </div>
                        `).join('')}
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-bold text-blue-800 mb-3">ğŸ“‹ ØºÛŒØ¨Øª Ù…ÙˆØ¬Ù‡ (${justifiedMembers.length})</h3>
                        ${justifiedMembers.map(member => `
                            <div class="text-blue-700 py-1 border-b border-blue-200 last:border-b-0">
                                ${member.fullName}
                            </div>
                        `).join('')}
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h3 class="font-bold text-yellow-800 mb-3">â° ØªØ§Ø®ÛŒØ± (${lateMembers.length})</h3>
                        ${lateMembers.map(member => `
                            <div class="text-yellow-700 py-1 border-b border-yellow-200 last:border-b-0">
                                ${member.fullName}
                            </div>
                        `).join('')}
                    </div>
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="font-bold text-red-800 mb-3">âŒ ØºØ§ÛŒØ¨ÛŒÙ† (${absentMembers.length})</h3>
                        ${absentMembers.map(member => `
                            <div class="text-red-700 py-1 border-b border-red-200 last:border-b-0">
                                ${member.fullName}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 left-4 px-6 py-3 rounded-lg text-white font-semibold z-50 slide-in ${
                type === 'success' ? 'bg-green-600' : 'bg-red-600'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9688c40e602a9dc2',t:'MTc1NDA4NzI3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
